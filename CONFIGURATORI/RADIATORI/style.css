:root {
    --primary-color: #005A9C; --primary-light: #E6F0F8; --primary-dark: #003d6b;
    --background-color: #f4f7f9; --card-background: #ffffff;
    --text-primary: #1e293b; --text-secondary: #64748b;
    --border-color: #e2e8f0; --danger-color: #ef4444;
    --font-family: 'Inter', sans-serif;
    --radius: 8px;
    --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.07), 0 2px 4px -2px rgba(0,0,0,0.07);
}

* { box-sizing: border-box; }

body {
    font-family: var(--font-family);
    background-color: var(--background-color);
    margin: 0;
    color: var(--text-primary);
    line-height: 1.6;
}

.hidden { display: none !important; }

/* Header e Titolo */
.app-header {
    background-color: var(--card-background);
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    box-shadow: var(--shadow-md);
}
.app-header .logo { height: 40px; }
.header-user-info { margin-left: 1.5rem; }
.page-header { padding: 1.5rem; text-align: center; }
.page-title { font-size: 2rem; font-weight: 700; color: var(--primary-dark); margin: 0; }

/* Layout Principale */
main#content-area { padding: 0 1.5rem 1.5rem; }
.configurator-container {
    display: grid;
    grid-template-columns: 420px 1fr;
    gap: 1.5rem;
    max-width: 1400px;
    margin: 0 auto;
}

.configurator-col {
    background-color: var(--card-background);
    padding: 1.5rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border-color);
}
.left-col { display: flex; flex-direction: column; max-height: calc(100vh - 150px); }

.section-title {
    font-size: 1.25rem; font-weight: 600; color: var(--primary-color);
    margin: 0 0 1.5rem 0; padding-bottom: 0.75rem;
    border-bottom: 2px solid var(--primary-color);
}

/* Form */
.form-group { margin-bottom: 1rem; }
.form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.9em; }
.form-group input, .form-group select {
    width: 100%; padding: 10px 12px; border: 1px solid #ccc;
    border-radius: 6px; font-size: 1em; font-family: var(--font-family);
    transition: border-color 0.2s, box-shadow 0.2s;
}
.form-group input:focus, .form-group select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px var(--primary-light); }
.form-group select[disabled] { background-color: #f1f1f1; cursor: not-allowed; }
.form-row { display: flex; gap: 1rem; }
.form-row .form-group { flex: 1; }
.form-subtitle { font-weight: 600; margin-top: 1.5rem; margin-bottom: 1rem; color: var(--primary-dark); }

/* Bottoni */
.btn {
    width: 100%; color: white; padding: 12px 15px; border: none;
    border-radius: 6px; cursor: pointer; font-size: 1em; font-weight: 500;
    display: inline-flex; align-items: center; justify-content: center;
    gap: 8px; transition: background-color 0.2s;
}
.btn-add { background-color: #2563eb; }
.btn-add:hover { background-color: #1d4ed8; }
.btn-primary { background-color: var(--primary-color); font-size: 1.1em; padding: 14px; }
.btn-primary:hover { background-color: var(--primary-dark); }
.configurator-action { margin-top: 2rem; }

/* Lista Stanze Aggiunte */
#add-local-form { flex-shrink: 0; }
#added-locals-container { margin-top: 2rem; flex-grow: 1; min-height: 0; display: flex; flex-direction: column; }
#added-locals-list { overflow-y: auto; padding-right: 10px; }
.empty-list-msg { text-align: center; color: var(--text-secondary); font-style: italic; padding: 2rem 0; }
.local-item {
    display: flex; align-items: flex-start; justify-content: space-between;
    padding: 12px; border-radius: 6px; margin-bottom: 10px;
    background-color: var(--primary-light); border: 1px solid #bde0fe;
}
.local-item-info strong { display: block; font-size: 1.1em; color: var(--primary-dark); }
.local-item-info .radiator-details { font-size: 0.9em; color: var(--text-secondary); }
.remove-local-btn {
    background: none; border: none; color: var(--danger-color); font-size: 1.2rem;
    cursor: pointer; line-height: 1; padding: 2px 5px; flex-shrink: 0; margin-left: 10px;
}
.remove-local-btn:hover { color: #b91c1c; }

/* Risultati */
#results-container { margin-top: 2rem; }
.results-main-title { text-align: center; color: var(--primary-dark); font-size: 1.8rem; }
.error-box { background-color: #fff1f2; color: #b91c1c; border: 1px solid #fecdd3; padding: 1rem; border-radius: 6px; margin: 1.5rem 0; }
.table-container { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border-color); }
th { background-color: #f1f5f9; font-weight: 600; font-size: 0.9em; }
.totals-summary { margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid var(--border-color); text-align: right; }
.totals-summary h3 { margin: 0 0 1rem 0; }
.total-line { display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 1.1rem; }
.total-line.price { font-size: 1.5rem; font-weight: 700; color: var(--primary-color); }
.totals-summary small { color: var(--text-secondary); display: block; margin-top: 1rem; }

/* Responsive */
@media (max-width: 1200px) {
    .configurator-container { grid-template-columns: 1fr; }
    .left-col { max-height: none; }
}```

### 3. `script.js` (Logica aggiornata per il nuovo menu)
Lo script ora gestisce la logica del nuovo menu: mostra il campo per il nome personalizzato solo se si seleziona "Altro" e recupera il nome corretto (dalla selezione o dal campo di testo) quando si aggiunge la stanza.

```javascript
document.addEventListener('DOMContentLoaded', () => {

    // --- DATABASE PRODOTTI ---
    const radiatorCatalog = {
        "IRSAP": {
            "TESI 2": [
                { id: 5, altezza: 565, watt: 40.9, prezzo: 15.9 }, { id: 18, altezza: 1000, watt: 69.2, prezzo: 22.1 },
                { id: 19, altezza: 1200, watt: 82.5, prezzo: 26.1 }, { id: 20, altezza: 1500, watt: 103.0, prezzo: 34.8 },
                { id: 22, altezza: 1800, watt: 124.3, prezzo: 40.4 }, { id: 24, altezza: 2000, watt: 139.0, prezzo: 43.2 },
                { id: 26, altezza: 2200, watt: 154.2, prezzo: 52.6 }, { id: 27, altezza: 2500, watt: 177.8, prezzo: 58.6 }
            ],
            "TESI 3": [
                { id: 32, altezza: 565, watt: 57.4, prezzo: 17.0 }, { id: 45, altezza: 1000, watt: 96.8, prezzo: 26.7 },
                { id: 46, altezza: 1200, watt: 114.8, prezzo: 32.9 }, { id: 47, altezza: 1500, watt: 141.7, prezzo: 44.2 },
                { id: 49, altezza: 1800, watt: 168.9, prezzo: 52.6 }, { id: 51, altezza: 2000, watt: 187.2, prezzo: 58.5 },
                { id: 53, altezza: 2200, watt: 205.7, prezzo: 68.7 }, { id: 54, altezza: 2500, watt: 233.7, prezzo: 74.9 }
            ],
            "TESI 4": [
                { id: 59, altezza: 565, watt: 74.8, prezzo: 19.6 }, { id: 72, altezza: 1000, watt: 125.9, prezzo: 31.9 },
                { id: 73, altezza: 1200, watt: 148.8, prezzo: 40.3 }, { id: 74, altezza: 1500, watt: 182.6, prezzo: 54.4 },
                { id: 76, altezza: 1800, watt: 216.0, prezzo: 65.3 }, { id: 78, altezza: 2000, watt: 238.1, prezzo: 71.6 },
                { id: 80, altezza: 2200, watt: 260.0, prezzo: 83.7 }, { id: 81, altezza: 2500, watt: 292.8, prezzo: 91.0 }
            ],
            // ... (altri modelli TESI come prima) ...
        }
    };

    // --- STATO APPLICAZIONE ---
    let addedLocals = [];

    // --- COEFFICIENTI DI CALCOLO (W/m³) ---
    const heatLossCoefficients = {
        RESIDENZIALE_MODERNO: 30, RESIDENZIALE_TRADIZIONALE: 40,
        VECCHIO_EDIFICIO: 55, ALTA_EFFICIENZA: 25,
    };
    const SCONTO_VENDITA = -0.40;

    // --- SELEZIONE ELEMENTI DOM ---
    const localTypeSelect = document.getElementById('local-type-select');
    const customNameContainer = document.getElementById('custom-local-name-container');
    const customNameInput = document.getElementById('custom-local-name-input');
    const localSqmInput = document.getElementById('local-sqm-input');
    const localHeightInput = document.getElementById('local-height-input');
    const addLocalBtn = document.getElementById('add-local-btn');
    const addedLocalsList = document.getElementById('added-locals-list');
    const brandSelect = document.getElementById('radiator-brand');
    const modelSelect = document.getElementById('radiator-model');
    const heightSelect = document.getElementById('radiator-height');
    const calculateBtn = document.getElementById('calculate-btn');
    const resultsContainer = document.getElementById('results-container');
    const errorDiv = document.getElementById('error-message');

    // --- FUNZIONI ---
    function populateModels() {
        const models = Object.keys(radiatorCatalog.IRSAP);
        modelSelect.innerHTML = '<option value="">Seleziona...</option>';
        heightSelect.innerHTML = '<option value="">...</option>';
        heightSelect.disabled = true;
        models.forEach(model => modelSelect.innerHTML += `<option value="${model}">${model}</option>`);
        modelSelect.disabled = false;
    }

    function populateHeights() {
        const model = modelSelect.value;
        const heights = radiatorCatalog.IRSAP[model] || [];
        heightSelect.innerHTML = '<option value="">Seleziona...</option>';
        if (heights.length > 0) {
            heights.forEach(v => heightSelect.innerHTML += `<option value="${v.id}">${v.altezza} mm</option>`);
            heightSelect.disabled = false;
        } else {
            heightSelect.disabled = true;
        }
    }

    function renderAddedLocals() {
        addedLocalsList.innerHTML = '';
        if (addedLocals.length === 0) {
            addedLocalsList.innerHTML = '<p class="empty-list-msg">Nessuna stanza ancora aggiunta.</p>';
            return;
        }
        addedLocals.forEach(local => {
            const div = document.createElement('div');
            div.className = 'local-item';
            div.innerHTML = `
                <div class="local-item-info">
                    <strong>${local.name} (${local.sqm} mq)</strong>
                    <span class="radiator-details">${local.radiatorInfo}</span>
                </div>
                <button class="remove-local-btn" data-id="${local.id}" title="Rimuovi">×</button>
            `;
            addedLocalsList.appendChild(div);
        });
    }

    function resetAddForm() {
        localTypeSelect.value = '';
        customNameInput.value = '';
        customNameContainer.classList.add('hidden');
        localSqmInput.value = '';
        modelSelect.value = '';
        heightSelect.innerHTML = '<option value="">...</option>';
        heightSelect.disabled = true;
    }
    
    function handleAddLocal() {
        const type = localTypeSelect.value;
        let name = type;
        if (type === 'ALTRO') {
            name = customNameInput.value.trim();
        }

        const sqm = parseFloat(localSqmInput.value);
        const roomHeight = parseFloat(localHeightInput.value);
        const radiatorId = parseInt(heightSelect.value, 10);
        const model = modelSelect.value;

        if (!name || !sqm || !roomHeight) { return alert('Compila tutti i dati della stanza.'); }
        if (!radiatorId) { return alert('Seleziona un modello e un\'altezza per il radiatore.'); }

        const radiator = radiatorCatalog.IRSAP[model].find(r => r.id === radiatorId);
        
        addedLocals.push({
            id: Date.now(), name, sqm, roomHeight, radiatorId, model,
            radiatorInfo: `Radiatore: IRSAP ${model} (H: ${radiator.altezza}mm
