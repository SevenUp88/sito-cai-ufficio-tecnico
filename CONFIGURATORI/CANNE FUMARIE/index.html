<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAI - Configuratore Canne Fumarie</title>
    
    <link rel="stylesheet" href="../../style.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        #content-area { padding: 15px; }
        .configuratore-container {
            width: 100%; max-width: 900px; margin: 20px auto;
            background-color: #ffffff; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); overflow: hidden;
        }
        .config-header {
            background-color: #0056a8; color: white;
            padding: 1.5rem 2rem; text-align: center;
        }
        .config-header h1 { margin: 0; font-size: 1.8rem; }
        #configForm { padding: 2rem; }
        .form-step { display: none; }
        .form-step.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .form-step h2 {
            color: #0056a8; margin-top: 0;
            border-bottom: 2px solid #e9ecef; padding-bottom: 10px;
        }
        .visual-selector { text-align: center; margin-top: 2rem; }
        .selection-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 2rem; }
        .selection-card {
            border: 2px solid #dee2e6; border-radius: 8px; padding: 1rem;
            cursor: pointer; transition: all 0.2s ease-in-out; width: 220px;
        }
        .selection-card:hover { border-color: #0056a8; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .selection-card .image-wrapper { height: 120px; margin-bottom: 1rem; display: flex; align-items: center; justify-content: center; }
        .selection-card .image-wrapper img { max-height: 100%; max-width: 100%; object-fit: contain; }
        .selection-card span { font-weight: 600; font-size: 1.1em; color: #343a40; }
        input[type="radio"].hidden-radio { display: none; }
        input[type="radio"].hidden-radio:checked + .selection-card {
            border-color: #d71920; background-color: #fdf2f2;
        }
        .component-row { display: flex; align-items: center; gap: 1rem; padding: 1rem; border-bottom: 1px solid #e9ecef; }
        .component-row .image-wrapper { flex-shrink: 0; width: 60px; height: 60px; display:flex; align-items:center; justify-content:center; }
        .component-row svg { height: 50px; color: #495057; }
        .component-details { flex-grow: 1; }
        .component-quantity input { width: 80px; text-align: center; }
        #riepilogo { background-color: #f8f9fa; padding: 1.5rem; border-radius: 8px; border: 1px solid #e9ecef; }
        #riepilogo h3 { color: #0056a8; }
        #lista-prodotti li { border-bottom: 1px dotted #ced4da; }
        .total-price span { color: #28a745; }

        /* Stili per allineare i bottoni del configuratore a quelli della home */
        .btn-container button, .btn-container a { text-decoration: none; }
        .nav-button.btn-prev { background-color: #6c757d; }
        .nav-button.btn-prev:hover { background-color: #5a6268; }
        .nav-button.btn-calculate { background-color: #28a745; }
        .nav-button.btn-calculate:hover { background-color: #218838; }
        .nav-button.btn-send { background-color: #ff8c00; }
        .nav-button.btn-send:hover { background-color: #e67e00; }
    </style>
</head>
<body>
    <!-- HEADER IDENTICO ALLA HOME PAGE -->
    <header class="app-header">
        <a href="../../index.html">
            <img src="https://raw.githubusercontent.com/SevenUp88/sito-cai-ufficio-tecniCO/main/LOGO%20CAI_.png" alt="Logo Ufficio Tecnico CAI" class="logo">
        </a>
        <div class="header-controls">
            <a href="../../index.html" class="nav-button"><i class="fas fa-home"></i> Torna alla Home</a>
        </div>
    </header>

    <main id="content-area">
        <div class="configuratore-container">
            <div class="config-header">
                <h1>Configuratore Canne Fumarie</h1>
            </div>

            <form id="configForm">
                <!-- Step 1: Installazione Visiva CORRETTO -->
                <div class="form-step active" data-step="1">
                    <h2>1. Scegli il tipo di scarico</h2>
                    <div class="visual-selector">
                        <div class="selection-container">
                            <input type="radio" id="install-verticale" name="installazione" value="verticale" class="hidden-radio" checked>
                            <label for="install-verticale" class="selection-card">
                                <div class="image-wrapper">
                                    <img src="../immagini/scarico_verticale.png" alt="Scarico Verticale">
                                </div>
                                <span>Verticale</span> <!-- TESTO CORRETTO -->
                            </label>
                            
                            <input type="radio" id="install-orizzontale" name="installazione" value="orizzontale" class="hidden-radio">
                            <label for="install-orizzontale" class="selection-card">
                                <div class="image-wrapper">
                                    <img src="../immagini/scarico_orizzontale.png" alt="Scarico Orizzontale">
                                </div>
                                <span>Orizzontale</span> <!-- TESTO CORRETTO -->
                            </label>
                        </div>
                    </div>
                    <div class="btn-container" style="justify-content: flex-end;">
                        <!-- BOTTONE CORRETTO NELLO STILE E FUNZIONANTE -->
                        <button type="button" class="nav-button btn-next">Avanti</button>
                    </div>
                </div>

                <!-- Step 2: Dimensioni e Materiali -->
                <div class="form-step" data-step="2">
                    <h2>2. Scegli materiali e diametri</h2>
                    <div class="form-group"><label for="tipologia">Tipo di Parete</label><select id="tipologia" name="tipologia"><option value="monoparete" selected>Monoparete</option><option value="doppiaparete">Doppiaparete</option></select></div>
                    <div class="form-group" id="materiale-monoparete-group"><label for="materiale-monoparete">Materiale Monoparete</label><select id="materiale-monoparete" name="materiale-monoparete"><option value="pps">PPS</option><option value="inox">INOX</option></select></div>
                    <div class="form-group" id="diametro-monoparete-group"><label for="diametro-mono">Diametro (mm)</label><select id="diametro-mono" name="diametro-mono"><option value="60">Ø 60 mm</option><option value="80" selected>Ø 80 mm</option></select></div>
                    <div id="doppiaparete-fields" class="hidden">
                        <div class="form-group"><label for="materiale-doppiaparete">Materiale Doppiaparete</label><select id="materiale-doppiaparete" name="materiale-doppiaparete"><option value="pps/pps">PPS/PPS</option><option value="pps/inox">PPS/INOX</option></select></div>
                        <div class="form-group"><label for="diametro-interno">Diametro Interno</label><select id="diametro-interno" name="diametro-interno"><option value="80" selected>Ø 80 mm</option></select></div>
                        <div class="form-group"><label for="diametro-esterno">Diametro Esterno</label><select id="diametro-esterno" name="diametro-esterno"><option value="130" selected>Ø 130 mm</option></select></div>
                    </div>
                    <div class="btn-container">
                        <button type="button" class="nav-button btn-prev">Indietro</button>
                        <button type="button" class="nav-button btn-next">Avanti</button>
                    </div>
                </div>
                
                <!-- Step 3: Componenti -->
                <div class="form-step" data-step="3">
                    <h2>3. Aggiungi i componenti necessari</h2>
                    <div class="component-row"><div class="image-wrapper"><svg viewBox="0 0 20 100"><rect x="5" y="0" width="10" height="100" fill="currentColor"/></svg></div><div class="component-details"><label for="el-1000">Elemento rettilineo L=1m</label><span class="code">Cod. 253632 / 281074</span></div><div class="component-quantity"><input id="el-1000" type="number" value="3" min="0" data-prezzo="20.00" data-nome="Elemento Rettilineo 1m" data-codice-80="253632" data-codice-60="281074"></div></div>
                    <div class="component-row"><div class="image-wrapper"><svg viewBox="0 0 20 60"><rect x="5" y="0" width="10" height="60" fill="currentColor"/></svg></div><div class="component-details"><label for="el-500">Elemento rettilineo L=0.5m</label><span class="code">Cod. 253631 / 281072</span></div><div class="component-quantity"><input id="el-500" type="number" value="1" min="0" data-prezzo="14.00" data-nome="Elemento Rettilineo 0.5m" data-codice-80="253631" data-codice-60="281072"></div></div>
                    <div class="component-row"><div class="image-wrapper"><svg viewBox="0 0 60 60"><path d="M5,50 A45,45 0 0,1 50,5" stroke="currentColor" stroke-width="10" fill="none" stroke-linecap="round"/></svg></div><div class="component-details"><label for="curva-90">Curva a 87°/90°</label><span class="code">Cod. 253635 / 281080</span></div><div class="component-quantity"><input id="curva-90" type="number" value="1" min="0" data-prezzo="16.00" data-nome="Curva a 87°/90°" data-codice-80="253635" data-codice-60="281080"></div></div>
                    <div class="component-row"><div class="image-wrapper"><svg viewBox="0 0 60 60"><path d="M5,40 A40,40 0 0,1 40,5" stroke="currentColor" stroke-width="10" fill="none" stroke-linecap="round"/></svg></div><div class="component-details"><label for="curva-45">Curva a 45°</label><span class="code">Cod. 253634 / 281078</span></div><div class="component-quantity"><input id="curva-45" type="number" value="2" min="0" data-prezzo="15.50" data-nome="Curva a 45°" data-codice-80="253634" data-codice-60="281078"></div></div>
                    <div class="component-row"><div class="image-wrapper"><svg viewBox="0 0 60 80"><path d="M30,5 V75 M5,40 H55" stroke="currentColor" stroke-width="10" fill="none" stroke-linecap="round"/></svg></div><div class="component-details"><label for="raccordo-t">Raccordo a T 87°</label><span class="code">Cod. 253 / 28108</span></div><div class="component-quantity"><input id="raccordo-t" type="number" value="1" min="0" data-prezzo="35.00" data-nome="Raccordo a T 87°" data-codice-80="253" data-codice-60="28108"></div></div>
                    <div class="component-row"><div class="image-wrapper"><svg viewBox="0 0 60 60"><circle cx="30" cy="30" r="20" stroke="currentColor" stroke-width="8" fill="none"/><path d="M10 30 H50" stroke="#fff" stroke-width="4"/><rect x="25" y="0" width="10" height="15" fill="currentColor"/><rect x="25" y="45" width="10" height="15" fill="currentColor"/></svg></div><div class="component-details"><label for="fascetta">Fascetta stringitubo</label><span class="code">Cod. 515 / 514</span></div><div class="component-quantity"><input id="fascetta" type="number" value="4" min="0" data-prezzo="5.00" data-nome="Fascetta Stringitubo" data-codice-80="515" data-codice-60="514"></div></div>
                    <div id="vertical-components">
                        <div class="component-row"><div class="image-wrapper"><svg viewBox="0 0 100 80"><path d="M0 80 L50 10 L100 80" stroke="#aaa" stroke-width="2" fill="none"/><rect x="40" y="30" width="20" height="50" fill="currentColor"/><path d="M30 30 H70" fill="none" stroke="currentColor" stroke-width="5"/></svg></div><div class="component-details"><label for="faldaie">Faldaie piatto</label><span class="code">Cod. 8065</span></div><div class="component-quantity"><input id="faldaie" type="number" value="1" min="0" data-prezzo="45.00" data-nome="Faldaie Piatto" data-codice-80="8065" data-codice-60="N/A"></div></div>
                        <div class="component-row"><div class="image-wrapper"><svg viewBox="0 0 80 60"><path d="M10 50 A 30 10 0 0 1 70 50 Z" fill="currentColor"/><rect x="35" y="0" width="10" height="50" fill="currentColor"/></svg></div><div class="component-details"><label for="terminale">Terminale parapioggia</label><span class="code">Cod. N/A</span></div><div class="component-quantity"><input id="terminale" type="number" value="1" min="0" data-prezzo="28.00" data-nome="Terminale Parapioggia" data-codice-80="N/A" data-codice-60="N/A"></div></div>
                    </div>
                    <div class="btn-container">
                        <button type="button" class="nav-button btn-prev">Indietro</button>
                        <button type="button" class="nav-button btn-calculate">Calcola Preventivo</button>
                    </div>
                </div>
                
                <!-- Step 4: Riepilogo -->
                <div class="form-step" data-step="4">
                    <h2>4. Riepilogo e Preventivo</h2>
                    <div id="riepilogo">
                        <h3>Dettaglio Configurazione</h3>
                        <p><strong>Installazione:</strong> <span id="riepilogo-installazione"></span></p>
                        <p><strong>Tipologia:</strong> <span id="riepilogo-tipologia"></span></p>
                        <p><strong>Materiale:</strong> <span id="riepilogo-materiale"></span></p>
                        <p><strong>Diametri:</strong> <span id="riepilogo-diametro"></span></p>
                        <h3 style="margin-top: 2rem;">Lista Componenti</h3>
                        <ul id="lista-prodotti"></ul>
                        <div class="total-price">Totale Stimato: <span id="prezzo-totale">€ 0.00</span></div>
                    </div>
                    <div class="btn-container">
                        <button type="button" class="nav-button btn-prev">Modifica</button>
                        <button type="button" class="nav-button btn-send">Invia Richiesta</button>
                    </div>
                </div>
            </form>
        </div>
    </main>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const nextButtons = document.querySelectorAll('.btn-next');
        const prevButtons = document.querySelectorAll('.btn-prev');
        const calculateButton = document.querySelector('.btn-calculate');
        const formSteps = document.querySelectorAll('.form-step');
        const tipologiaSelect = document.getElementById('tipologia');
        const doppiapareteFields = document.getElementById('doppiaparete-fields');
        const monoMaterialGroup = document.getElementById('materiale-monoparete-group');
        const monoDiameterGroup = document.getElementById('diametro-monoparete-group');
        const verticalComponents = document.getElementById('vertical-components');
        let currentStep = 1;
        const goToStep = (step) => { currentStep = step; formSteps.forEach(s => s.classList.toggle('active', parseInt(s.dataset.step) === currentStep)); };
        const updateConditionalFields = () => {
            const isMonoparete = tipologiaSelect.value === 'monoparete';
            doppiapareteFields.classList.toggle('hidden', isMonoparete);
            monoMaterialGroup.classList.toggle('hidden', !isMonoparete);
            monoDiameterGroup.classList.toggle('hidden', !isMonoparete);
            const installazioneValue = document.querySelector('input[name="installazione"]:checked').value;
            verticalComponents.classList.toggle('hidden', installazioneValue !== 'verticale');
        };
        document.querySelectorAll('input[name="installazione"]').forEach(radio => { radio.addEventListener('change', updateConditionalFields); });
        tipologiaSelect.addEventListener('change', updateConditionalFields);
        nextButtons.forEach(b => b.addEventListener('click', () => goToStep(currentStep + 1)));
        prevButtons.forEach(b => b.addEventListener('click', () => goToStep(currentStep - 1)));
        calculateButton.addEventListener('click', () => { calcolaPreventivo(); goToStep(currentStep + 1); });
        const calcolaPreventivo = () => {
            const isMonoparete = tipologiaSelect.value === 'monoparete';
            const diametroSelezionato = isMonoparete ? document.getElementById('diametro-mono').value : document.getElementById('diametro-interno').value;
            const codiceAttr = `data-codice-${diametroSelezionato}`;
            let diametroText = isMonoparete ? document.querySelector('#diametro-mono option:checked').text : `${document.querySelector('#diametro-interno option:checked').text} / ${document.querySelector('#diametro-esterno option:checked').text}`;
            document.getElementById('riepilogo-installazione').textContent = document.querySelector('input[name="installazione"]:checked + label span').textContent;
            document.getElementById('riepilogo-tipologia').textContent = document.querySelector('#tipologia option:checked').text;
            document.getElementById('riepilogo-materiale').textContent = isMonoparete ? document.querySelector('#materiale-monoparete option:checked').text : document.querySelector('#materiale-doppiaparete option:checked').text;
            document.getElementById('riepilogo-diametro').textContent = diametroText;
            const componentInputs = document.querySelectorAll('.form-step[data-step="3"] input[type="number"]');
            const listaProdottiEl = document.getElementById('lista-prodotti');
            const prezzoTotaleEl = document.getElementById('prezzo-totale');
            listaProdottiEl.innerHTML = '';
            let totale = 0;
            componentInputs.forEach(input => {
                const row = input.closest('.component-row');
                if (row && (window.getComputedStyle(row).display === 'none' || window.getComputedStyle(row.parentElement).display === 'none')) return;
                const quantita = parseInt(input.value);
                if (quantita > 0) {
                    const prezzoUnitario = parseFloat(input.dataset.prezzo);
                    const nomeProdotto = input.dataset.nome;
                    const codiceProdotto = input.getAttribute(codiceAttr) || 'N/D';
                    const subTotale = quantita * prezzoUnitario;
                    totale += subTotale;
                    const li = document.createElement('li');
                    li.innerHTML = `<div class="product-info">${nomeProdotto} (x${quantita})<span class="product-code">Cod. ${codiceProdotto}</span></div><strong>€ ${subTotale.toFixed(2)}</strong>`;
                    listaProdottiEl.appendChild(li);
                }
            });
            prezzoTotaleEl.textContent = `€ ${totale.toFixed(2)}`;
        };
        goToStep(1);
        updateConditionalFields();
    });
</script>

</body>
</html>
