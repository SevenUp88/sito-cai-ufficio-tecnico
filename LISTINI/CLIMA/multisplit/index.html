<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuratore Multisplit - CAI</title>
    
    <!-- CSS Principale -->
    <link rel="stylesheet" href="/style.css">
    
    <!-- Font e Icone -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        /* --- STILI DI SICUREZZA LAYOUT --- */
        body { font-family: 'Roboto', sans-serif; background-color: #f4f6f9; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .hidden { display: none !important; }
        .sidebar { width: 260px; background: #fff; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; flex-shrink: 0; overflow-y: auto; z-index: 100; }
        .sidebar-brand { padding: 15px; text-align: center; border-bottom: 1px solid #eee; }
        .sidebar-brand img { max-width: 180px; }
        .sidebar-menu { list-style: none; padding: 10px 0; margin: 0; }
        .nav-link { display: flex; align-items: center; padding: 12px 20px; color: #333; text-decoration: none; font-weight: 500; justify-content: space-between; cursor: pointer; }
        .nav-link:hover, .nav-link.active { background-color: #f0f7ff; color: #0056a8; }
        .submenu-list { list-style: none; padding: 0; background-color: #fafafa; overflow: hidden; max-height: 0; transition: max-height 0.3s ease; }
        .submenu-list li a { padding: 10px 20px 10px 55px; display: block; color: #666; text-decoration: none; font-size: 0.9rem; }
        
        .main-content { flex: 1; display: flex; flex-direction: column; overflow-y: auto; }
        .top-bar { height: 70px; background: #fff; border-bottom: 1px solid #e0e0e0; display: flex; align-items: center; justify-content: space-between; padding: 0 30px; flex-shrink: 0; }
        .content-container { padding: 30px; max-width: 1200px; margin: 0 auto; width: 100%; box-sizing: border-box; }

        /* --- STILI DEL TUO CONFIGURATORE ORIGINALE (Adattati) --- */
        .config-step { display: none; padding: 20px; border: 1px solid #e0e0e0; border-radius: 8px; background-color: #fff; margin-bottom: 25px; }
        .config-step.active-step { display: block; }
        .config-step h2 { color: #0056a8; border-bottom: 2px solid #0056a8; padding-bottom: 10px; margin-top: 0; }
        
        .step-indicator { display: flex; justify-content: space-between; margin-bottom: 35px; padding: 0 10px; }
        .step-item { text-align: center; flex: 1; position: relative; cursor: pointer; opacity: 0.6; }
        .step-item.active, .step-item.completed { opacity: 1; font-weight: bold; }
        .step-dot { width: 30px; height: 30px; background: #eee; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 5px; }
        .step-item.active .step-dot { background: #0056a8; color: white; }
        .step-item.completed .step-dot { background: #28a745; color: white; }

        /* Griglie */
        .selection-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; }
        .selection-item { border: 2px solid #e0e0e0; border-radius: 8px; padding: 15px; text-align: center; cursor: pointer; min-height: 150px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .selection-item:hover { border-color: #0056a8; }
        .selection-item.selected { border-color: #0056a8; background-color: #e6f0fa; }
        .selection-item img { max-height: 80px; margin-bottom: 10px; object-fit: contain; }

        /* Cards UE/UI */
        .unit-selection-card { border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-bottom: 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .unit-selection-card:hover { border-color: #0056a8; }
        .unit-selection-card.selected { border-color: #0056a8; background: #f0f7ff; }
        .unit-price { font-weight: bold; color: #0056a8; font-size: 1.1em; }
        
        /* Tasto PDF */
        .technical-sheet-button { 
            display: inline-block; padding: 5px 10px; background: #dc3545; color: white; 
            border-radius: 4px; text-decoration: none; font-size: 0.85em; margin-top: 10px; 
        }
        .technical-sheet-button:hover { background: #b02a37; }

        .step-navigation { margin-top: 30px; display: flex; justify-content: space-between; border-top: 1px solid #eee; padding-top: 20px; }
        .btn-nav { padding: 10px 20px; border-radius: 5px; cursor: pointer; border: none; font-size: 1rem; }
        .prev-btn { background: #6c757d; color: white; }
        .next-btn { background: #0056a8; color: white; }
        .next-btn:disabled { background: #ccc; cursor: not-allowed; }

        /* Riepilogo */
        .summary-section { background: #f8f9fa; padding: 20px; border-radius: 8px; }
        .summary-detail-block { background: white; padding: 15px; margin-bottom: 15px; border-radius: 4px; border: 1px solid #ddd; }
        .total-price-iva { font-size: 1.3em; color: #0056a8; font-weight: bold; text-align: right; margin-top: 20px; }

        @media print {
            .sidebar, .top-bar, .step-indicator, .step-navigation, .print-instructions { display: none !important; }
            .config-step { display: none !important; }
            #step-6 { display: block !important; border: none; }
            .summary-section { border: 1px solid #000; }
        }
    </style>
</head>
<body>

    <div id="initial-loader" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#fff;z-index:9999;display:flex;justify-content:center;align-items:center;flex-direction:column;">
        <i class="fas fa-spinner fa-spin" style="font-size:3rem;color:#0056a8;margin-bottom:20px;"></i>
        <p>Caricamento Configuratore...</p>
    </div>

    <!-- Login -->
    <section id="login-section" class="hidden" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#f4f6f9;z-index:2000;display:flex;justify-content:center;align-items:center;">
        <div style="background:#fff;padding:40px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.1);text-align:center;width:350px;">
            <img src="https://raw.githubusercontent.com/SevenUp88/sito-cai-ufficio-tecnico/main/LOGO%20CAI_.png" alt="Logo" style="max-width:180px;margin-bottom:20px;">
            <form id="login-form">
                <input type="email" id="email" required placeholder="Email" style="width:100%;padding:10px;margin-bottom:15px;border:1px solid #ccc;border-radius:4px;">
                <input type="password" id="password" required placeholder="Password" style="width:100%;padding:10px;margin-bottom:15px;border:1px solid #ccc;border-radius:4px;">
                <button type="submit" style="width:100%;padding:10px;background:#0056a8;color:white;border:none;border-radius:4px;cursor:pointer;">Accedi</button>
            </form>
        </div>
    </section>

    <!-- App -->
    <div id="app-content" class="hidden" style="display:flex; width:100%;">
        
        <nav class="sidebar">
            <div class="sidebar-brand"><a href="/"><img src="https://raw.githubusercontent.com/SevenUp88/sito-cai-ufficio-tecnico/main/LOGO%20CAI_.png" alt="Logo"></a></div>
            <!-- Menu copiato staticamente per sicurezza -->
            <ul class="sidebar-menu">
                <li><a href="/" class="nav-link"><i class="fas fa-th-large"></i> Dashboard</a></li>
                <li class="has-submenu"><a href="#" class="nav-link"><i class="fas fa-handshake"></i> Noleggi</a><ul class="submenu-list"><li><a href="/NOLEGGI/code.html">Attrezzature</a></li><li><a href="/NOLEGGI/GAS/index.html">Gas</a></li></ul></li>
                <li><a href="/PREVENTIVI/index.html" class="nav-link"><i class="fas fa-calculator"></i> Preventivazione</a></li>
                <li class="has-submenu"><a href="#" class="nav-link active"><i class="fas fa-list"></i> Listini</a>
                    <ul class="submenu-list open">
                        <li><a href="/LISTINI/CLIMA/monosplit/index.html">Clima Monosplit</a></li>
                        <li><a href="#" style="color:#0056a8;font-weight:bold;">Clima Multisplit</a></li>
                        <li><a href="/LISTINI/CALDAIE/index.html">Caldaie</a></li>
                        <li><a href="/LISTINI/SCALDABAGNI/index.html">Scaldabagno</a></li>
                        <li><a href="/LISTINI/SANITARI/index.html">Sanitari</a></li>
                        <li><a href="/LISTINI/LISTINI%20FORNITORI/index.html">Fornitori</a></li>
                    </ul>
                </li>
                <li><a href="/SCHEDE%20TECNICHE/index.html" class="nav-link"><i class="fas fa-clipboard-list"></i> Schede Tecniche</a></li>
                <li class="has-submenu"><a href="#" class="nav-link"><i class="fas fa-cogs"></i> Configuratori</a><ul class="submenu-list"><li><a href="/CONFIGURATORI/IMPIANTO RADIANTE/index.html">Radiante</a></li><li><a href="/CONFIGURATORI/RADIATORI/index.html">Radiatori</a></li><li><a href="/CONFIGURATORI/CANNE FUMARIE/index.html">Canne Fumarie</a></li></ul></li>
                <li><a href="/SCONTISTICHE/index.html" class="nav-link"><i class="fas fa-tags"></i> Scontistiche</a></li>
                <li><a href="/AGENDA%20CONSEGNE/index.html" class="nav-link"><i class="fas fa-calendar-alt"></i> Agenda</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <header class="top-bar">
                <div class="page-title"><h2>Configuratore Multisplit</h2></div>
                <div class="user-profile-info"><span id="user-email-display">...</span><button id="logout-button" style="border:none;background:none;"><i class="fas fa-sign-out-alt"></i></button></div>
            </header>

            <div class="content-container">
                
                <!-- STRUTTURA CONFIGURATORE ORIGINALE -->
                <div class="step-indicator">
                    <div class="step-item active" data-step="1"><div class="step-dot">1</div><span class="step-name">Marca</span></div>
                    <div class="step-item" data-step="2"><div class="step-dot">2</div><span class="step-name">Config.</span></div>
                    <div class="step-item" data-step="3"><div class="step-dot">3</div><span class="step-name">Serie</span></div>
                    <div class="step-item" data-step="4"><div class="step-dot">4</div><span class="step-name">Esterna</span></div>
                    <div class="step-item" data-step="5"><div class="step-dot">5</div><span class="step-name">Interne</span></div>
                    <div class="step-item" data-step="6"><div class="step-dot">6</div><span class="step-name">Riepilogo</span></div>
                </div>

                <div id="step-1" class="config-step active-step">
                    <h2>1. Seleziona Marca</h2>
                    <div id="brand-selection" class="selection-grid"></div>
                </div>

                <div id="step-2" class="config-step">
                    <h2>2. Scegli Configurazione</h2>
                    <div id="config-type-selection" class="selection-grid"></div>
                    <div class="step-navigation"><button class="prev-btn" onclick="showStep(1)">Indietro</button></div>
                </div>

                <div id="step-3" class="config-step">
                    <h2>3. Seleziona Modello UI</h2>
                    <div id="model-selection" class="selection-grid"></div>
                    <div class="step-navigation"><button class="prev-btn" onclick="showStep(2)">Indietro</button></div>
                </div>

                <div id="step-4" class="config-step">
                    <h2>4. Seleziona Unità Esterna</h2>
                    <div id="outdoor-unit-selection" class="selection-list"></div>
                    <div class="step-navigation"><button class="prev-btn" onclick="showStep(3)">Indietro</button></div>
                </div>

                <div id="step-5" class="config-step">
                    <h2>5. Seleziona Unità Interne</h2>
                    <div id="indoor-units-selection-area"></div>
                    <div class="step-navigation">
                        <button class="prev-btn" onclick="showStep(4)">Indietro</button>
                        <button class="next-btn" id="finalize-btn" disabled>Vai al Riepilogo</button>
                    </div>
                </div>

                <div id="step-6" class="config-step">
                    <h2 id="summary-main-title">Riepilogo Configurazione</h2>
                    <div id="config-summary" class="summary-section"></div>
                    <div class="step-navigation summary-actions">
                        <button class="prev-btn" onclick="showStep(5)">Modifica</button>
                        <button class="next-btn" onclick="window.print()">Stampa</button>
                        <button class="prev-btn" style="background:#dc3545;" onclick="location.reload()">Nuovo</button>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // LOGICA ORIGINALE RIPRISTINATA (con fix PDF)
        document.addEventListener('DOMContentLoaded', async () => {
            const firebaseConfig = { apiKey: "AIzaSyC_gm-MK5dk2jc_MmmwO7TWBm7oW_D5t1Y", authDomain: "consorzio-artigiani-idraulici.firebaseapp.com", projectId: "consorzio-artigiani-idraulici", storageBucket: "consorzio-artigiani-idraulici.appspot.com", messagingSenderId: "136848104008", appId: "1:136848104008:web:71e2195f1712a832e01b3a" };
            if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();

            const APP_DATA = { brands: [], configTypes: {}, outdoorUnits: [], indoorUnits: [], uiSeriesImageMapping: {} };
            const selections = { brand: null, configType: null, indoorSeries: null, outdoorUnit: null, indoorUnits: [] };

            // Auth
            auth.onAuthStateChanged(user => {
                document.getElementById('initial-loader').style.display='none';
                if(user) {
                    document.getElementById('login-section').classList.add('hidden');
                    document.getElementById('app-content').classList.remove('hidden');
                    document.getElementById('user-email-display').textContent = user.email;
                    loadData();
                } else {
                    document.getElementById('login-section').classList.remove('hidden');
                    document.getElementById('app-content').classList.add('hidden');
                }
            });

            document.getElementById('login-form').addEventListener('submit', e => { e.preventDefault(); auth.signInWithEmailAndPassword(e.target[0].value, e.target[1].value); });
            document.getElementById('logout-button').addEventListener('click', () => auth.signOut());

            // Menu toggle
            document.querySelectorAll('.has-submenu > .nav-link').forEach(l => l.addEventListener('click', e => { e.preventDefault(); l.nextElementSibling.style.maxHeight = l.nextElementSibling.style.maxHeight ? null : '500px'; }));

            async function loadData() {
                try {
                    const [b, c, o, i, m] = await Promise.all([
                        db.collection('brands').get(),
                        db.collection('configTypes').get(),
                        db.collection('outdoorUnits').get(),
                        db.collection('indoorUnits').get(),
                        db.collection('uiSeriesImageMapping').get()
                    ]);
                    
                    APP_DATA.brands = b.docs.map(d => ({id:d.id, ...d.data()}));
                    APP_DATA.configTypes = c.docs.reduce((a,d) => { a[d.id] = {id:d.id, ...d.data()}; return a; }, {});
                    
                    // FIX HAIER 5 SPLIT E PDF
                    APP_DATA.outdoorUnits = o.docs.map(d => {
                        const dt = d.data();
                        return {
                            id: d.id, ...dt,
                            brandId: (dt.marca||'').toLowerCase().trim(),
                            connections: Number(dt.unita_collegabili || dt.unit_collegabili || dt.connections || 0),
                            price: Number(dt.prezzo||0),
                            compatibleIndoorSeriesIds: dt.compatibleIndoorSeriesIds || [],
                            scheda_tecnica_url: dt.scheda_tecnica_url
                        };
                    });

                    APP_DATA.indoorUnits = i.docs.map(d => {
                        const dt = d.data();
                        const sId = (dt.modello||'').toLowerCase().replace(/\s+/g,'_') + '_ui';
                        return {
                            id: d.id, ...dt,
                            brandId: (dt.marca||'').toLowerCase().trim(),
                            seriesId: sId,
                            price: Number(dt.prezzo_ui||0),
                            capacityBTU: parseInt((dt.potenza||'').match(/\d+/)?.[0] || 0),
                            kw: (dt.potenza||'').match(/[\d.,]+kW/)?.[0] || 'N/D',
                            scheda_tecnica_url: dt.scheda_tecnica_url
                        };
                    });
                    
                    m.docs.forEach(d => { const dt=d.data(); if(dt.seriesKey) APP_DATA.uiSeriesImageMapping[dt.seriesKey] = dt.imageName; });

                    populateBrands();
                } catch(e) { console.error(e); alert("Errore dati."); }
            }

            // --- FUNZIONI ORIGINALI DI POPOLAMENTO ---
            window.showStep = function(step) {
                document.querySelectorAll('.config-step').forEach(s => s.classList.remove('active-step'));
                document.getElementById(`step-${step}`).classList.add('active-step');
                
                document.querySelectorAll('.step-item').forEach((el, i) => {
                    const s = i + 1;
                    if(s === step) { el.classList.add('active'); el.classList.remove('completed'); }
                    else if(s < step) { el.classList.add('completed'); el.classList.remove('active'); }
                    else { el.classList.remove('active', 'completed'); }
                });
                
                if(step===6) renderSummary();
            };

            function populateBrands() {
                const div = document.getElementById('brand-selection');
                const validBrands = [...new Set(APP_DATA.outdoorUnits.map(u => u.brandId))];
                div.innerHTML = APP_DATA.brands.filter(b => validBrands.includes(b.id)).map(b => `
                    <div class="selection-item" onclick="selectBrand('${b.id}')">
                        <img src="${b.logo}" style="max-height:80px; margin-bottom:10px;">
                        <span>${b.name}</span>
                    </div>
                `).join('');
            }
            window.selectBrand = (id) => { selections.brand = APP_DATA.brands.find(b => b.id === id); populateConfigs(); showStep(2); };

            function populateConfigs() {
                const div = document.getElementById('config-type-selection');
                const allowed = APP_DATA.outdoorUnits.filter(u => u.brandId === selections.brand.id).map(u => u.connections);
                const configs = Object.values(APP_DATA.configTypes).filter(c => allowed.includes(c.numUnits)).sort((a,b)=>a.numUnits-b.numUnits);
                div.innerHTML = configs.map(c => `
                    <div class="selection-item" onclick="selectConfig('${c.id}')">
                        <span style="font-size:2em; color:#0056a8;">${c.numUnits}</span>
                        <span>${c.name}</span>
                    </div>
                `).join('');
            }
            window.selectConfig = (id) => { selections.configType = APP_DATA.configTypes[id]; populateSeries(); showStep(3); };

            function populateSeries() {
                const div = document.getElementById('model-selection');
                const compatUE = APP_DATA.outdoorUnits.filter(u => u.brandId === selections.brand.id && u.connections === selections.configType.numUnits);
                const seriesIds = new Set();
                compatUE.forEach(u => u.compatibleIndoorSeriesIds?.forEach(id => seriesIds.add(id)));
                
                const unique = []; const seen = new Set();
                APP_DATA.indoorUnits.forEach(u => {
                    if(seriesIds.has(u.seriesId) && !seen.has(u.seriesId)) {
                        unique.push({id: u.seriesId, name: u.modello, img: APP_DATA.uiSeriesImageMapping[u.seriesId]});
                        seen.add(u.seriesId);
                    }
                });
                
                div.innerHTML = unique.map(s => {
                    const img = s.img ? `/LISTINI/CLIMA/images/${s.img}.png` : '/placeholder.png';
                    return `<div class="selection-item" onclick="selectSeries('${s.id}')">
                        <img src="${img}" style="max-height:100px;">
                        <span>${s.name}</span>
                    </div>`;
                }).join('');
            }
            window.selectSeries = (id) => { selections.indoorSeries = {id}; populateUE(); showStep(4); };

            function populateUE() {
                const div = document.getElementById('outdoor-unit-selection');
                const list = APP_DATA.outdoorUnits.filter(u => 
                    u.brandId === selections.brand.id && 
                    u.connections === selections.configType.numUnits &&
                    u.compatibleIndoorSeriesIds?.includes(selections.indoorSeries.id)
                );
                
                div.innerHTML = list.map(u => {
                    // *** FIX PDF AGGIUNTO QUI ***
                    const pdfBtn = u.scheda_tecnica_url ? `<a href="${u.scheda_tecnica_url}" target="_blank" class="technical-sheet-button" onclick="event.stopPropagation()">Scheda Tecnica</a>` : '';
                    
                    return `<div class="unit-selection-card" onclick="selectUE('${u.id}')">
                        <div style="flex:1">
                            <h4>${u.modello || u.codice_prodotto}</h4>
                            <p>Codice: ${u.codice_prodotto}</p>
                            <p>Potenza: ${u.potenza} kW</p>
                            <div class="unit-price">€ ${u.price.toFixed(2)}</div>
                        </div>
                        ${pdfBtn}
                    </div>`;
                }).join('');
            }
            window.selectUE = (id) => { selections.outdoorUnit = APP_DATA.outdoorUnits.find(u => u.id === id); populateUI(); showStep(5); };

            function populateUI() {
                const div = document.getElementById('indoor-units-selection-area');
                const count = selections.configType.numUnits;
                selections.indoorUnits = new Array(count).fill(null);
                
                const opts = APP_DATA.indoorUnits.filter(i => i.seriesId === selections.indoorSeries.id);
                const unique = []; const seen = new Set();
                opts.forEach(i => { if(!seen.has(i.capacityBTU)) { unique.push(i); seen.add(i.capacityBTU); } });
                unique.sort((a,b) => a.capacityBTU - b.capacityBTU);

                div.innerHTML = '';
                for(let i=0; i<count; i++) {
                    div.innerHTML += `
                    <div style="background:#f9f9f9; padding:15px; margin-bottom:15px; border:1px solid #ddd; border-radius:8px;">
                        <h4>Unità Interna ${i+1}</h4>
                        <div style="display:flex; gap:10px; flex-wrap:wrap;">
                            ${unique.map(u => `
                                <button style="padding:10px; border:1px solid #ccc; background:white; cursor:pointer; flex:1;" 
                                    onclick="pickUI(${i}, '${u.id}', this)">
                                    ${u.capacityBTU} BTU<br>€ ${u.price.toFixed(0)}
                                </button>
                            `).join('')}
                        </div>
                        <div id="preview-ui-${i}" style="margin-top:10px; font-weight:bold; color:#0056a8;"></div>
                    </div>`;
                }
                document.getElementById('finalize-btn').disabled = true;
                
                document.getElementById('finalize-btn').onclick = () => showStep(6);
            }

            window.pickUI = (idx, id, btn) => {
                btn.parentElement.querySelectorAll('button').forEach(b => b.style.backgroundColor = 'white');
                btn.style.backgroundColor = '#e6f0fa';
                
                const unit = APP_DATA.indoorUnits.find(u => u.id === id);
                selections.indoorUnits[idx] = unit;
                
                const pdf = unit.scheda_tecnica_url ? ` <a href="${unit.scheda_tecnica_url}" target="_blank" style="color:#dc3545"><i class="fas fa-file-pdf"></i></a>` : '';
                document.getElementById(`preview-ui-${idx}`).innerHTML = `Selezionato: ${unit.codice_prodotto} ${pdf}`;
                
                document.getElementById('finalize-btn').disabled = !selections.indoorUnits.every(u => u);
            };

            function renderSummary() {
                const div = document.getElementById('config-summary');
                const s = selections;
                let tot = s.outdoorUnit.price; s.indoorUnits.forEach(u => tot += u.price);
                
                div.innerHTML = `
                    <div class="summary-detail-block">
                        <h3>Preventivo ${s.brand.name}</h3>
                        <p><strong>Unità Esterna:</strong> ${s.outdoorUnit.modello} (${s.outdoorUnit.codice_prodotto}) - € ${s.outdoorUnit.price.toFixed(2)}
                           ${s.outdoorUnit.scheda_tecnica_url ? `<a href="${s.outdoorUnit.scheda_tecnica_url}" target="_blank" style="color:#dc3545"><i class="fas fa-file-pdf"></i></a>` : ''}
                        </p>
                        ${s.indoorUnits.map((u,i) => `
                            <p><strong>UI ${i+1}:</strong> ${u.modello} (${u.capacityBTU} BTU) - € ${u.price.toFixed(2)}
                            ${u.scheda_tecnica_url ? `<a href="${u.scheda_tecnica_url}" target="_blank" style="color:#dc3545"><i class="fas fa-file-pdf"></i></a>` : ''}
                            </p>
                        `).join('')}
                        <h3 class="total-price-iva">TOTALE: € ${tot.toFixed(2)}</h3>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
