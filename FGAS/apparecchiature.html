<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>CAI - Modulo Apparecchiature FGAS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="../style.css">

    <style>
        /* --- STILI DI BASE --- */
        body { background-color: #f0f2f5; font-family: Arial, sans-serif; }
        .hidden { display: none !important; }
        
        /* Wrapper Modulo */
        .modulo-wrapper { 
            max-width: 800px; margin: 20px auto; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .paper-form { background: #fff; padding: 40px; border: 1px solid #ccc; color: #000; min-height: 1000px; }
        .form-actions { text-align: center; padding: 20px 0; }

        /* Typography & Inputs */
        h1, h2, h3, p, label { margin: 0; padding: 0; font-weight: normal; }
        input[type="text"], input[type="date"] {
            border: none; border-bottom: 1px solid #000; background: transparent; width: 100%; padding: 2px 0; font-size: 0.9rem; font-family: Arial, sans-serif; border-radius: 0;
        }
        input:focus { outline: none; border-bottom: 1px solid #0056a8; }
        input:disabled { background: #f8f8f8; border-bottom: 1px dotted #ccc; cursor: not-allowed; }
        
        .riga { display: flex; align-items: baseline; gap: 20px; margin-top: 15px; }
        .campo { display: flex; align-items: baseline; gap: 8px; flex-grow: 1; }
        .campo label { white-space: nowrap; font-size: 0.85rem; font-weight: bold; }
        
        .separatore { border: 0; border-top: 1.5px dashed #ccc; margin: 20px 0; }
        
        .checkbox-label { display: flex; align-items: center; gap: 10px; font-size: 1rem; font-weight: bold; background: #eee; padding: 5px 10px; margin-bottom: 10px; }
        .checkbox-label input { width: 18px; height: 18px; cursor: pointer; }
        
        .modulo-header { text-align: center; margin-bottom: 25px; }
        .modulo-header h1 { font-size: 1.1rem; font-weight: bold; }
        .modulo-header .highlight { background-color: #ffff00; padding: 0 5px; border: 1px solid #ddd; }
        .modulo-header p { font-size: 0.9rem; margin-top: 5px; font-style: italic; }
        
        .dati-acquirente-title { font-size: 0.9rem; font-weight: bold; margin-top: 5px; color: #c00000; text-transform: uppercase; border-bottom: 1px solid #c00000; display: inline-block; }
        
        .oppure { font-weight: bold; margin: 15px 0; font-size: 0.9rem; text-align: center; background: #f0f0f0; padding: 2px; }
        
        .dichiarazione { margin-top: 25px; text-align: center; border: 2px solid #000; padding: 15px; }
        .dichiarazione h2 { font-size: 0.85rem; font-weight: bold; margin-bottom: 5px; color: #333; }
        .dichiarazione h3 { font-size: 1.1rem; font-weight: bold; margin-bottom: 8px; }
        .dichiarazione p { font-size: 0.9rem; text-align: justify; line-height: 1.4; }
        
        .signature-area { display: flex; justify-content: space-between; margin-top: 30px; gap: 40px;}
        .signature-area .campo { flex-basis: 45%; }
        .signature-area .firma { flex-basis: 45%; display: flex; flex-direction: column; gap: 25px; }
        .signature-area .firma .campo { flex-direction: column; align-items: flex-start; }
        .signature-area .firma label { margin-bottom: 20px; font-style: italic; }
        
        .modulo-footer { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 15px; }
        .modulo-footer .allegato { font-weight: bold; font-size: 0.9rem; margin-bottom: 10px; }
        .modulo-footer .informativa p { font-size: 0.75rem; text-align: justify; line-height: 1.3; color: #555; }

        /* Loader */
        .loader-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #f4f6f9; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .loader-spinner {
            border: 4px solid #e9ecef; border-top: 4px solid #0056a8;
            border-radius: 50%; width: 50px; height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        @media print {
            body, .modulo-wrapper { margin: 0; padding: 0; background: #fff; border: none; width: 100%; box-shadow: none; max-width: none; }
            .sidebar, .top-bar, .form-actions, #initial-loader, #login-section { display: none !important; }
            #app-content { display: block !important; margin: 0 !important; padding: 0 !important; }
            .main-content { margin-left: 0 !important; padding: 0 !important; }
            .paper-form { border: none; padding: 0; margin: 0; }
            body * { visibility: hidden; }
            #form-to-print, #form-to-print * { visibility: visible; }
            #form-to-print { position: absolute; left: 0; top: 0; width: 100%; }
        }
    </style>
</head>
<body>

    <!-- Loader -->
    <div id="initial-loader" class="loader-container"><div class="loader-spinner"></div><p style="margin-top:10px;">Caricamento...</p></div>

    <!-- LOGIN -->
    <section id="login-section" class="hidden login-centered">
        <div class="login-card">
            <img src="https://raw.githubusercontent.com/SevenUp88/sito-cai-ufficio-tecnico/main/LOGO%20CAI_.png" alt="Logo CAI" class="login-logo">
            <h2>Area Riservata</h2>
            <form id="login-form">
                <div class="form-group"><label>Email</label><input type="email" id="email" required></div>
                <div class="form-group"><label>Password</label><input type="password" id="password" required></div>
                <button type="submit" class="btn-login">Accedi</button>
            </form>
        </div>
    </section>

    <!-- APP CONTENT -->
    <div id="app-content" class="dashboard-wrapper hidden">
        
        <!-- SIDEBAR -->
        <nav class="sidebar">
            <div class="sidebar-brand"><a href="/"><img src="https://raw.githubusercontent.com/SevenUp88/sito-cai-ufficio-tecnico/main/LOGO%20CAI_.png" alt="Logo CAI"></a></div>
            <ul class="sidebar-menu"></ul> <!-- Gestito da components.js -->
            <div class="sidebar-footer">&copy; 2025 CAI Solutions</div>
        </nav>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- Header generato da components.js -->

            <div class="content-container">
                <div class="modulo-wrapper">
                    
                    <!-- FOGLIO A4 -->
                    <div id="form-to-print" class="paper-form">
                        <header class="modulo-header">
                            <h1>MODULO DICHIARAZIONE ACQUISTO <span class="highlight">APPARECCHIATURE FGAS</span></h1>
                            <p>Da sottoscrivere in DUPLICE COPIA (per il venditore e per l'acquirente)</p>
                        </header>
                        
                        <form id="apparecchiature-form" onsubmit="return false;">
                            <section class="riga">
                                <div class="campo"><label>Codice cliente</label><input type="text" id="pdf-cliente"></div>
                                <div class="campo"><label>N. bolla</label><input type="text" id="pdf-ddt"></div>
                                <div class="campo"><label>Data bolla</label><input type="date" id="data-bolla"></div>
                            </section>
                            
                            <hr class="separatore">
                            
                            <!-- SEZIONE 1 -->
                            <section id="section-impresa-certificata">
                                <div class="checkbox-label"><input type="checkbox" id="is-impresa-certificata"> IMPRESA CERTIFICATA</div>
                                <div class="riga">
                                    <div class="campo"><label>Ragione sociale</label><input type="text" id="cert-ragione-sociale"></div>
                                </div>
                                <div class="riga">
                                    <div class="campo"><label>N. certificazione</label><input type="text" id="cert-n-certificazione"></div>
                                    <div class="campo"><label>COD. FISC.</label><input type="text" id="cert-cod-fisc"></div>
                                </div>
                            </section>
                            
                            <section id="section-dati-acquirente" style="margin-top: 25px;">
                                <p class="dati-acquirente-title">DATI ACQUIRENTE (dati obbligatori se nell'ordine o nella bolla è indicato)</p>
                                <div class="riga">
                                    <div class="campo"><label>Denominazione</label><input type="text" id="acq-denominazione"></div>
                                    <div class="campo"><label>CODICE FISCALE</label><input type="text" id="acq-cod-fisc"></div>
                                </div>
                            </section>
                            
                            <hr class="separatore">
                            
                            <!-- SEZIONE 2 -->
                            <section id="section-altre-finalita">
                                <div class="checkbox-label"><input type="checkbox" id="is-altre-finalita"> ALTRE FINALITA' (IMPRESA/ENTE/PROFESSIONISTA/ PERSONA NON CERTIFICATA)</div>
                                <div class="riga">
                                    <div class="campo"><label>Nome Cognome</label><input type="text" id="altre-nome-cognome"></div>
                                    <div class="campo"><label>COD.FISC.</label><input type="text" id="altre-cod-fisc-persona"></div>
                                </div>
                                <p class="oppure">OPPURE</p>
                                <div class="riga">
                                    <div class="campo"><label>Ragione sociale</label><input type="text" id="altre-ragione-sociale"></div>
                                    <div class="campo"><label>COD. FISC.</label><input type="text" id="altre-cod-fisc-impresa"></div>
                                </div>
                            </section>
                            
                            <!-- DICHIARAZIONE -->
                            <section class="dichiarazione">
                                <h2>Ai sensi dell'art. 16, comme 3, lettera d), del d.P.R. 16 novembre 2018, n. 146</h2>
                                <h3>DICHIARA</h3>
                                <p>L'impegno ad ottemperare a quanto previsto dall'art. 16, comma 3, lettera d), del d.P.R. 16 novembre 2018, n. 146, assumendosi l'obbligo che l'installazione sarà effettuata da un'impresa certificata a norma dell'articolo 10 del regolamento (UE) n. 517/2014.</p>
                            </section>
                            
                            <section class="signature-area">
                                <div class="campo"><label>Luogo e data</label><input type="text"></div>
                                <div class="firma">
                                    <div class="campo"><label>Nome e cognome del dichiarante</label><input type="text"></div>
                                    <div class="campo"><label>Firma</label><input type="text" readonly style="cursor: default; border-bottom: 1px solid #000;"></div>
                                </div>
                            </section>
                            
                            <footer class="modulo-footer">
                                <p class="allegato">Si allega alla presente dichiarazione copia di un documento di identità in corso di validità.</p>
                                <div class="informativa">
                                    <p><strong>INFORMATIVA AI SENSI DEL D.LGS. 196/2003:</strong> In qualità di titolari del trattamento dei dati forniti con la compilazione del presente modulo Vi informiamo che i dati raccolti verranno trattati e conservati secondo correttezza e utilizzati esclusivamente per adempiere a specifici obblighi previsti dal Regolamento europeo 517/2014. Non saranno oggetto di comunicazione né di diffusione. In ogni momento sarà possibile esercitare i diritti previsti dall'articolo 13 del decreto legislativo 196/2003 ed in particolare chiedere la correzione, integrazione degli stessi. Il titolare del trattamento è C.A.I. SOC. COOP. CONS. P.A. con sede in Cesenatico, via Dei Girasoli n. 13</p>
                                </div>
                            </footer>
                        </form>
                    </div>
                    
                    <div class="form-actions">
                        <button id="save-pdf-button" class="btn-login" style="font-size: 1.1rem; padding: 12px 30px;"><i class="fas fa-print"></i> Stampa Modulo</button>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- Componenti -->
    <script src="/components.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded",() => {
            const firebaseConfig = { apiKey: "AIzaSyC_gm-MK5dk2jc_MmmwO7TWBm7oW_D5t1Y", authDomain: "consorzio-artigiani-idraulici.firebaseapp.com", projectId: "consorzio-artigiani-idraulici", storageBucket: "consorzio-artigiani-idraulici.appspot.com", messagingSenderId: "136848104008", appId: "1:136848104008:web:71e2195f1712a832e01b3a" };
            if(!firebase.apps.length) firebase.initializeApp(firebaseConfig);
            const auth=firebase.auth();

            // Layout
            initLayout("Modulo Apparecchiature FGAS");

            const ui = {
                loader: document.getElementById('initial-loader'),
                login: document.getElementById('login-section'),
                app: document.getElementById('app-content'),
                loginForm: document.getElementById('login-form')
            };

            auth.onAuthStateChanged(user => {
                ui.loader.style.display='none';
                if(user){
                    ui.login.classList.add('hidden');
                    ui.app.classList.remove('hidden');
                    initializeForm();
                } else {
                    ui.login.classList.remove('hidden');
                    ui.app.classList.add('hidden');
                }
            });

            if(ui.loginForm) {
                ui.loginForm.addEventListener('submit', e => {
                    e.preventDefault();
                    auth.signInWithEmailAndPassword(e.target.email.value, e.target.password.value).catch(err=>alert(err.message));
                });
            }

            function initializeForm(){
                const checkImpresa = document.getElementById("is-impresa-certificata");
                const checkAltre = document.getElementById("is-altre-finalita");
                const inputsImpresa = Array.from(document.querySelectorAll('#section-impresa-certificata input:not([type="checkbox"])'));
                const inputsAltre = Array.from(document.querySelectorAll('#section-altre-finalita input:not([type="checkbox"])'));
                const saveButton = document.getElementById("save-pdf-button");
                const dataBollaInput = document.getElementById("data-bolla");
                
                if(dataBollaInput) dataBollaInput.valueAsDate = new Date();
                
                function toggleFields(inputs, isEnabled){
                    inputs.forEach(input=>{
                        input.disabled=!isEnabled;
                        if(!isEnabled) input.value="";
                    });
                }
                
                checkImpresa.addEventListener("change",()=>{
                    toggleFields(inputsImpresa, checkImpresa.checked);
                    if(checkImpresa.checked){ checkAltre.checked=false; toggleFields(inputsAltre,false); }
                });
                
                checkAltre.addEventListener("change",()=>{
                    toggleFields(inputsAltre, checkAltre.checked);
                    if(checkAltre.checked){ checkImpresa.checked=false; toggleFields(inputsImpresa,false); }
                });
                
                // Tutti Maiuscoli
                document.querySelectorAll('input[type="text"]').forEach(input => {
                    input.addEventListener('input', (e) => { e.target.value = e.target.value.toUpperCase(); });
                });

                saveButton.addEventListener("click", () => window.print());

                // Init stato
                toggleFields(inputsImpresa,false); toggleFields(inputsAltre,false);
            }
        });
    </script>
</body>
</html>
